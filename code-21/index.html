<!DOCTYPE html>

<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <script src="https://kit.fontawesome.com/1205482781.js"></script>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
    integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    crossorigin="anonymous" />
  <link rel="stylesheet" type="text/css" href="style.css" />
  <title>Home</title>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <!--SIDEBAR VERTICAL-->
      <div class="col-2">
        <nav class="navbar navbar-expand-md navbar-white bg-navbar fixed-left justify-content-between" id="sidebar">
          <div class="nav-container">
            <a class="navbar-brand" href="index.html">
              <img src="logo/Spotify_Logo.png" alt="Spotify_Logo" width="131" height="40" />
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup"
              aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
              <div class="navbar-nav">
                <ul>
                  <li>
                    <a class="nav-item nav-link" href="index.html"><i class="fas fa-home fa-lg"></i>&nbsp; Home
                    </a>
                  </li>
                  <li>
                    <a class="nav-item nav-link" href="#"><i class="fas fa-book-open fa-lg"></i>&nbsp; Your
                      Library</a>
                  </li>
                  <li>
                    <div class="input-group mt-3">
                      <input type="text" class="form-control mb-2" id="searchField" placeholder="Search"
                        aria-label="Search" aria-describedby="basic-addon2" />
                      <div class="input-group-append" style="margin-bottom: 4%">
                        <button class="btn btn-outline-secondary btn-sm" type="button" id="searchButton">
                          GO
                        </button>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="nav-btn">
            <button class="btn signup-btn" type="button">Sign Up</button>
            <button class="btn login-btn" type="button">Login</button>
            <a href="#">Cookie Policy</a> |
            <a href="#"> Privacy</a>
          </div>
        </nav>
      </div>
      <!--END SIDEBAR VERTICAL-->

      <!--MAIN-->
      <div class="col-12 col-md-9 offset-md-3 mainPage">
        <div class="row justify-content-center">
          <div class="col-9 col-lg-11 mainLinks d-none d-md-flex">
            <a id="rockSongsButton" href="#">ROCK</a>
            <a id="popSongsButton" href="#">POP</a>
            <a id="hipHopSongsButton" href="#">HIP HOP</a>
          </div>
        </div>
        <div class="row">
          <div class="col-10">
            <div id="searchResults">
              <h2 id="searchTitle"></h2>
              <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4 imgLinks py-3" id="resultsContainer">
              </div>
            </div>
          </div>
        </div>
        <div class="row justify-content-center">
          <div class="col-10">
            <div id="results" class="d-none">
              <div class="spinner-border text-primary d-block m-auto" role="status" id="spinner">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--END MAIN-->

  <!--NAVBAR BOTTOM-->
  <div class="player container-fluid fixed-bottom bg-container pt-1">
    <div class="row flex-nowrap justify-content-between playBar py-3">
      <div class="col-auto">
        <div class="playerArtistInfo d-flex">
          <img />
          <div class="d-flex flex-column pl-2">
            <h6></h6>
            <p></p>
          </div>
        </div>
      </div>
      <div class="col-6">
        <div class="playerControls w-50 d-flex justify-content-between">
          <a href="#">
            <img src="playerbuttons/Shuffle.png" alt="shuffle" />
          </a>
          <a href="#">
            <img src="playerbuttons/Previous.png" alt="previous" />
          </a>
          <a href="#">
            <img src="playerbuttons/Play.png" alt="play" />
          </a>
          <a href="#">
            <img src="playerbuttons/Next.png" alt="next" />
          </a>
          <a href="#">
            <img src="playerbuttons/Repeat.png" alt="repeat" />
          </a>
        </div>
        <div class="progressContainer d-flex align-items-center">
          <span class="currentTime">00:00</span>
          <div class="progress w-100">
            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              <audio></audio>
            </div>
          </div>
          <span class="duration">00:00</span>
        </div>
      </div>
      <div class="col-auto mr-3">
        <div class="playerVolume">
          <i class="fa fa-volume-up"></i>
          <input type="range" value="100" />
        </div>
      </div>
    </div>
  </div>
  <!--END NAVBAR BOTTOM-->

  <!-- Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
    crossorigin="anonymous"></script>

  <script>
    // implement search songs functionality

    // Handle #searchButton click
    // search API: https://striveschool-api.herokuapp.com/api/deezer/search?q=
    // onLoad - search with default param: eminem
    // load different songs on HipHopSongsButton / PopSongsButton / RockSongsButton

    // Spinner on API Loading

    const rockArtists = ["queen", "u2", "thepolice", "eagles", "thedoors", "oasis", "thewho", "bonjovi"];
    const popArtists = ["maroon5", "coldplay", "onerepublic", "jamesblunt", "katyperry", "arianagrande"];
    const hipHopArtists = ["eminem", "snoopdogg", "lilwayne", "drake", "kanyewest"];

    const artistsByCategory = {
      rock: rockArtists,
      pop: popArtists,
      hipHop: hipHopArtists,
    };

    const BASE_URL = 'https://striveschool-api.herokuapp.com/api/deezer/search';
    const DEFAULT_SEARCH_TERM = 'eminem';

    // Caching HTML elements
    const resultsContainer = document.getElementById('resultsContainer');
    const searchTitle = document.getElementById('searchTitle');
    const searchButton = document.getElementById('searchButton');
    const searchField = document.getElementById('searchField');

    const rockSongsButton = document.getElementById('rockSongsButton');
    const popSongsButton = document.getElementById('popSongsButton');
    const hipHopSongsButton = document.getElementById('hipHopSongsButton');

    const results = document.getElementById('results');

    const populateSongResults = (songs) => {
      for (const song of songs) {
        const songCardHtml = `<div class="col text-center">
          <img class="img-fluid" src="${song.album.cover_small}" alt="${song.album.title}" />
          <p>
            <a href="./album_page.html?albumId=${song.album.id}">${song.album.title}</a>
            <br />
            <a href="./artist_page.html?artistId=${song.artist.id}">${song.artist.name}</a>
          </p>
        </div>`;

        resultsContainer.innerHTML += songCardHtml;
      }
    }

    const createSearchUrl = (term) => {
      const params = new URLSearchParams({q : term});

      return `${BASE_URL}?${params.toString()}`
    };

    const handleSearchButtonClick = () => {
      search(searchField.value);
    };

    const handleCategorySearchButtonClick = (category) => {
      const rockPromises = artistsByCategory[category].map(artist =>
        fetch(createSearchUrl(artist)).then(response => response.json())
      );

      // Promise.all accepts an array of promises
      // and returns a single promise
      // the value of the promise returned
      // is an array of values of all the promises involved 
      // if any of the promises involved is rejected - the Promise.all will return a rejected promise
      resultsContainer.innerHTML = '';
      results.classList.remove('d-none');
  
      Promise.all(rockPromises)
        .then((rockPromisesResults) => {
          const songs = rockPromisesResults.reduce((accumulator, currentObject) =>
            accumulator.concat(currentObject.data), []
          )

          populateSongResults(songs);
        })
        .finally(() => results.classList.add('d-none'));
    }

    // function definitions are hoisted =)

    // function search(term) {
    //   fetch(`${BASE_URL}?q=${term}`)
    //     .then(response => response.json())
    //     .then(responseObject => {
    //       populateSongResults(responseObject.data);
    //       searchTitle.innerText = term;
    //     });
    // };

    const search = (term) => {
      resultsContainer.innerHTML = '';
      results.classList.remove('d-none');
      
      fetch(createSearchUrl(term))
        .then(response => response.json())
        .then(responseObject => {
          populateSongResults(responseObject.data);
          searchTitle.innerText = term;
        })
        // finally will be executed whether or not there was an error in the chain
        .finally(() => results.classList.add('d-none'))
    };

    searchButton.addEventListener('click', handleSearchButtonClick);
    rockSongsButton.addEventListener('click', () => handleCategorySearchButtonClick('rock'))
    popSongsButton.addEventListener('click', () => handleCategorySearchButtonClick('pop'))
    hipHopSongsButton.addEventListener('click', () => handleCategorySearchButtonClick('hipHop'))

    search(DEFAULT_SEARCH_TERM);

  </script>
</body>

</html>
